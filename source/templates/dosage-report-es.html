<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reporte de Dosificación de {{.HormoneName}} - {{.PatientName}}</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=Duru+Sans:wght@400&display=swap");
      body {
        font-family: "Inter", sans-serif;
      }
      .font-duru {
        font-family: "Duru Sans", sans-serif;
      }
      .page-break-after {
        page-break-after: always;
        break-after: page;
      }
      .page-break-before {
        page-break-before: always;
        break-before: page;
      }
      .keep-together {
        page-break-inside: avoid;
        break-inside: avoid;
      }
    </style>
  </head>
  <body class="bg-white p-8 text-gray-900">
    <div class="mx-auto max-w-4xl">
      <!-- Encabezado -->
      <div class="mb-8 border-b border-gray-300 pb-4">
        <div class="mb-3 flex items-center">
          <div>
            <h1 class="font-duru text-xl font-bold text-gray-900">
              Equilibria Diagnostics
            </h1>
            <p class="text-sm text-gray-600">
              Terapia de Reemplazo Hormonal Personalizada
            </p>
          </div>
          <div class="ml-auto">
            <img
              src="https://app.equilibriahrt.com/logo.png"
              alt="Logo de Equilibria HRT"
              class="h-24 w-24"
            />
          </div>
        </div>

        <div class="mt-3 text-sm text-gray-500">
          <p>
            Reporte de Dosificación Generado: {{.ReportDate}} | Proveedor: {{.ProviderName}}
          </p>
        </div>
      </div>

      <!-- Introducción -->
      <div class="mb-8">
        <h3 class="mb-2 text-lg font-semibold text-gray-900">
          Reporte de Terapia de Reemplazo Hormonal
        </h3>
        <p class="text-sm leading-relaxed text-gray-700">
          Este reporte médico integral proporciona una evaluación detallada de
          su progreso en la terapia de reemplazo hormonal, estado actual y
          recomendaciones para la optimización continua del tratamiento.
        </p>
      </div>

      <!-- Sección de Información del Paciente -->
      <div class="mb-8">
        <h3
          class="mb-3 border-b border-gray-300 pb-2 text-lg font-bold text-gray-900"
        >
          Información del Paciente
        </h3>

        <table class="w-full border-collapse">
          <tbody>
            <tr>
              <td class="w-1/4 py-2 pr-4 text-sm font-semibold text-gray-700">
                Nombre:
              </td>
              <td class="w-1/4 py-2 pr-4 text-sm text-gray-900">
                {{.PatientName}}
              </td>
              <td class="w-1/4 py-2 pr-4 text-sm font-semibold text-gray-700">
                Edad:
              </td>
              <td class="w-1/4 py-2 text-sm text-gray-900">
                {{if and .Age (gt .Age 0)}}{{.Age}} años{{else}}No especificado{{end}}
              </td>
            </tr>
            <tr>
              <td class="py-2 pr-4 text-sm font-semibold text-gray-700">
                Sexo:
              </td>
              <td class="py-2 pr-4 text-sm text-gray-900 capitalize">
                {{if .Sex}}{{.Sex}}{{else}}No especificado{{end}}
              </td>
              <td class="py-2 pr-4 text-sm font-semibold text-gray-700">
                Estatura:
              </td>
              <td class="py-2 text-sm text-gray-900">
                {{if and .Height (gt .Height 0)}}{{div .Height 12}}'{{mod .Height 12}}"{{else}}No especificado{{end}}
              </td>
            </tr>
            <tr>
              <td class="py-2 pr-4 text-sm font-semibold text-gray-700">
                Peso:
              </td>
              <td class="py-2 pr-4 text-sm text-gray-900">
                {{if and .Weight (gt .Weight 0)}}{{.Weight}} lbs{{else}}No especificado{{end}}
              </td>
              <td class="py-2 pr-4 text-sm font-semibold text-gray-700">
                Etnia:
              </td>
              <td class="py-2 text-sm text-gray-900 capitalize">
                {{if .Ethnicity}}{{.Ethnicity}}{{else}}No especificado{{end}}
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Síntomas y Preocupaciones Actuales -->
      {{if .Symptoms}}
      <div class="mb-8">
        <h3
          class="mb-3 border-b border-gray-300 pb-2 text-lg font-bold text-gray-900"
        >
          Síntomas y Preocupaciones Actuales
        </h3>
        <div class="space-y-2 text-sm text-gray-700">
          {{if .Symptoms.Physical}}
          <div>
            <span class="font-medium">Síntomas Físicos:</span> {{.Symptoms.Physical}}
          </div>
          {{end}}
          {{if .Symptoms.Mood}}
          <div>
            <span class="font-medium">Estado de Ánimo/Salud Mental:</span> {{.Symptoms.Mood}}
          </div>
          {{end}}
          {{if .Symptoms.Energy}}
          <div>
            <span class="font-medium">Niveles de Energía:</span> {{.Symptoms.Energy}}
          </div>
          {{end}}
          {{if .Symptoms.SideEffects}}
          <div>
            <span class="font-medium">Efectos Secundarios:</span> {{.Symptoms.SideEffects}}
          </div>
          {{end}}
        </div>
      </div>
      {{end}}

      <!-- Mediciones Objetivas -->
      {{if .LabResults}}
      <div class="page-break-after mb-8">
        <h3
          class="mb-3 border-b border-gray-300 pb-2 text-lg font-bold text-gray-900"
        >
          Resultados de Laboratorio Recientes
        </h3>

        <h4 class="text-md mb-2 font-semibold text-gray-800">
          Resultados de Laboratorio ({{.LabResults.Date}})
        </h4>
        <table class="mb-4 w-full border-collapse">
          <thead>
            <tr class="border-b border-gray-200">
              <th class="py-2 pr-4 text-left font-semibold text-gray-700">
                Prueba
              </th>
              <th class="py-2 pr-4 text-left font-semibold text-gray-700">
                Resultado
              </th>
              <th class="py-2 pr-4 text-left font-semibold text-gray-700">
                Rango de Referencia
              </th>
              <th class="py-2 text-left font-semibold text-gray-700">Estado</th>
            </tr>
          </thead>
          <tbody>
            {{range .LabResults.Tests}}
            <tr class="border-b border-gray-100">
              <td class="py-2 pr-4 text-sm text-gray-900">{{.Name}}</td>
              <td class="py-2 pr-4 text-sm text-gray-900">
                {{.Value}} {{.Unit}}
              </td>
              <td class="py-2 pr-4 text-sm text-gray-600">
                {{.ReferenceRange}}
              </td>
              <td
                class="py-2 text-sm {{if eq .Status "Normal"}}text-green-600{{else if eq .Status "Abnormal"}}text-red-600{{else}}text-yellow-600{{end}}"
              >
                {{.Status}}
              </td>
            </tr>
            {{end}}
          </tbody>
        </table>
      </div>
      {{end}}

      <!-- Evaluación de Respuesta al Tratamiento -->
      {{if .TreatmentResponse}}
      <div class="mb-8">
        <h3
          class="mb-3 border-b border-gray-300 pb-2 text-lg font-bold text-gray-900"
        >
          Evaluación de Respuesta al Tratamiento
        </h3>
        <div class="space-y-3 text-sm text-gray-700">
          {{if .TreatmentResponse.PositiveChanges}}
          <div>
            <span class="font-medium">Cambios Positivos:</span> {{.TreatmentResponse.PositiveChanges}}
          </div>
          {{end}}
          {{if .TreatmentResponse.PersistentIssues}}
          <div>
            <span class="font-medium">Problemas Persistentes:</span> {{.TreatmentResponse.PersistentIssues}}
          </div>
          {{end}}
          {{if .TreatmentResponse.DoseAdjustments}}
          <div>
            <span class="font-medium">Ajustes Recientes:</span> {{.TreatmentResponse.DoseAdjustments}}
          </div>
          {{end}}
        </div>
      </div>
      {{end}}

      <!-- Objetivos y Resultados Deseados -->
      {{if .TreatmentGoals}}
      <div class="page-break-before mb-8">
        <h3
          class="mb-3 border-b border-gray-300 pb-2 text-lg font-bold text-gray-900"
        >
          Objetivos y Resultados Deseados
        </h3>
        <div class="space-y-2 text-sm text-gray-700">
          {{if .TreatmentGoals.ShortTerm}}
          <div>
            <span class="font-medium">Objetivos a Corto Plazo:</span> {{.TreatmentGoals.ShortTerm}}
          </div>
          {{end}}
          {{if .TreatmentGoals.LongTerm}}
          <div>
            <span class="font-medium">Objetivos a Largo Plazo:</span> {{.TreatmentGoals.LongTerm}}
          </div>
          {{end}}
          {{if .TreatmentGoals.TargetLevels}}
          <div>
            <span class="font-medium">Niveles Hormonales Objetivo:</span> {{.TreatmentGoals.TargetLevels}}
          </div>
          {{end}}
        </div>
      </div>
      {{end}}

      <!-- Recomendaciones y Próximos Pasos -->
      <div class="mb-8">
        <h3
          class="mb-3 border-b border-gray-300 pb-2 text-lg font-bold text-gray-900"
        >
          Recomendaciones y Próximos Pasos
        </h3>

        {{if .Hormones}}
        {{range $index, $hormone := .Hormones}}
        <div
          class="{{if ne $index (sub (len $.Hormones) 1)}}border-b pb-6{{end}} mb-6 border-gray-100"
        >
          <h4 class="text-md mb-3 font-semibold text-gray-800">
            Recomendaciones de {{.Name}}
          </h4>

          <div class="mb-4">
            <h5 class="mb-2 text-sm font-medium text-gray-700">
              Dosificación Recomendada
            </h5>
            <div class="mb-4">
              <div class="mb-3">
                <span class="text-4xl font-bold text-blue-600"
                  >{{.FinalDosage}}</span
                >
                <span class="ml-2 text-2xl font-semibold text-gray-600"
                  >mg</span
                >
              </div>

              <p class="max-w-2xl text-sm text-gray-600">
                {{if .IsOverride}}
                Esta dosificación ha sido ajustada por su proveedor de atención médica basándose en la evaluación clínica.
                {{else}}
                Basado en análisis integral de factores del paciente, resultados de laboratorio y directrices clínicas.
                {{end}}
              </p>
            </div>
          </div>

          {{if .IsOverride}}
          <!-- Información de Ajuste del Proveedor -->
          <div class="mb-6 border-l-4 border-blue-500 bg-blue-50 p-4">
            <h5 class="mb-3 text-sm font-semibold text-blue-800">
              Ajuste del Proveedor Aplicado
            </h5>

            <div class="mb-3 space-y-1">
              <div class="flex">
                <span class="w-48 text-xs font-medium text-gray-700"
                  >Recomendación del Algoritmo:</span
                >
                <span class="text-xs text-gray-900"
                  >{{.CalculatedDosage}}mg</span
                >
              </div>
              <div class="flex">
                <span class="w-48 text-xs font-medium text-gray-700"
                  >Dosificación del Proveedor:</span
                >
                <span class="text-xs font-semibold text-blue-600"
                  >{{.FinalDosage}}mg</span
                >
              </div>
              {{if .OverrideDate}}
              <div class="flex">
                <span class="w-48 text-xs font-medium text-gray-700"
                  >Fecha de Aplicación:</span
                >
                <span class="text-xs text-gray-900"
                  >{{.OverrideDate}}</span
                >
              </div>
              {{end}}
            </div>

            {{if .OverrideReason}}
            <div class="border-t border-blue-200 pt-3">
              <h6 class="mb-2 text-xs font-medium text-blue-800">
                Notas Clínicas:
              </h6>
              <p class="text-xs text-gray-700 italic">
                "{{.OverrideReason}}"
              </p>
            </div>
            {{end}}
          </div>
          {{else}}
          <!-- Distribución de Pellets -->
          {{if .Distribution}}
          <div class="mb-6">
            <h5 class="mb-3 text-sm font-medium text-gray-700">
              Distribución de Pellets Sugerida
            </h5>

            <div class="text-sm text-gray-700">
              {{range $pelletIndex, $pellet := .Distribution}}
              <span class="mr-2"
                >{{.Pellet}}mg x {{.Count}} pellets</span
              >{{if ne $pelletIndex (sub (len $.Distribution) 1)}}<span class="mx-2 text-gray-400">|</span>{{end}}
              {{end}}
            </div>

            <p class="mt-3 text-sm text-gray-500">
              La distribución de pellets está optimizada para la liberación
              constante de hormonas y comodidad del paciente.
            </p>
          </div>
          {{end}}
          {{end}}
          {{if .MaxSafeDose}}
          <div class="mb-3">
            <div class="flex">
              <span class="w-48 text-sm font-semibold text-gray-700"
                >Dosificación Máxima Segura:</span
              >
              <span class="text-sm font-semibold text-green-600"
                >{{.MaxSafeDose}} mg</span
              >
            </div>
          </div>
          {{end}}
        </div>
        {{end}}
        {{else}}
        <!-- Respaldo para una sola hormona (compatibilidad hacia atrás) -->
        <div class="mb-4">
          <h4 class="text-md mb-2 font-semibold text-gray-800">
            Dosificación Recomendada
          </h4>
          <div class="mb-4">
            <div class="mb-3">
              <span class="text-4xl font-bold text-blue-600"
                >{{.FinalDosage}}</span
              >
              <span class="ml-2 text-2xl font-semibold text-gray-600">mg</span>
            </div>

            <p class="max-w-2xl text-sm text-gray-600">
              {{if .IsOverride}}
              Esta dosificación ha sido ajustada por su proveedor de atención médica basándose en la evaluación clínica.
              {{else}}
              Basado en análisis integral de factores del paciente, resultados de laboratorio y directrices clínicas.
              {{end}}
            </p>
          </div>
        </div>
        {{end}}
        {{if .Recommendations}}
        <div class="mb-6">
          <h4 class="text-md mb-2 font-semibold text-gray-800">
            Recomendaciones Adicionales
          </h4>
          <div class="space-y-2 text-sm text-gray-700">
            {{if .Recommendations.Lifestyle}}
            <div>
              <span class="font-medium">Modificaciones del Estilo de Vida:</span> {{.Recommendations.Lifestyle}}
            </div>
            {{end}}
            {{if .Recommendations.Supplements}}
            <div>
              <span class="font-medium">Suplementos:</span> {{.Recommendations.Supplements}}
            </div>
            {{end}}
            {{if .Recommendations.FollowUp}}
            <div>
              <span class="font-medium">Seguimiento Requerido:</span> {{.Recommendations.FollowUp}}
            </div>
            {{end}}
          </div>
        </div>
        {{end}}
      </div>

      <!-- Cronograma y Plan de Monitoreo -->
      <div class="mb-8">
        <h3
          class="mb-3 border-b border-gray-300 pb-2 text-lg font-bold text-gray-900"
        >
          Cronograma y Plan de Monitoreo
        </h3>

        {{if .MonitoringPlan}}
        <div class="space-y-2 text-sm text-gray-700">
          {{if .MonitoringPlan.NextLabs}}
          <div>
            <span class="font-medium">Próximo Trabajo de Laboratorio:</span> {{.MonitoringPlan.NextLabs}}
          </div>
          {{end}}
          {{if .MonitoringPlan.FollowUpAppointment}}
          <div>
            <span class="font-medium">Cita de Seguimiento:</span> {{.MonitoringPlan.FollowUpAppointment}}
          </div>
          {{end}}
          {{if .MonitoringPlan.ReassessmentTimeline}}
          <div>
            <span class="font-medium">Reevaluación del Progreso:</span> {{.MonitoringPlan.ReassessmentTimeline}}
          </div>
          {{end}}
          {{if .MonitoringPlan.MetricsToTrack}}
          <div>
            <span class="font-medium">Métricas a Monitorear:</span> {{.MonitoringPlan.MetricsToTrack}}
          </div>
          {{end}}
        </div>
        {{else}}
        <div class="space-y-2 text-sm text-gray-700">
          <div>
            <span class="font-medium">Próximo Trabajo de Laboratorio:</span> Recomendado en 6-8
            semanas para evaluar los niveles hormonales
          </div>
          <div>
            <span class="font-medium">Cita de Seguimiento:</span> Programar
            dentro de 2-3 meses para revisar el progreso
          </div>
          <div>
            <span class="font-medium">Reevaluación del Progreso:</span> Monitoreo
            continuo de síntomas y niveles hormonales
          </div>
        </div>
        {{end}}
      </div>

      <!-- Información de Seguridad -->
      <div class="mb-8">
        <h3
          class="mb-3 border-b border-gray-300 pb-2 text-lg font-bold text-gray-900"
        >
          Información de Seguridad
        </h3>

        <p class="text-sm text-gray-700">
          Todas las recomendaciones de dosificación están dentro de los parámetros
          de seguridad establecidos para la terapia de reemplazo hormonal. Las
          dosificaciones prescritas han sido calculadas basándose en su perfil
          individual de paciente y directrices clínicas.
        </p>
      </div>

      <!-- Pie de página -->
      <div class="keep-together border-t-2 border-gray-300 pt-8 text-center">
        <div class="mb-6">
          <div class="mb-2 flex items-center justify-center">
            <div class="mr-3">
              <img
                src="https://app.equilibriahrt.com/logo.png"
                alt="Logo de Equilibria HRT"
                class="h-10 w-10"
              />
            </div>
            <div>
              <p class="font-duru font-bold text-gray-900">
                Equilibria Diagnostics
              </p>
              <p class="text-sm text-gray-600">
                Terapia de Reemplazo Hormonal Personalizada
              </p>
            </div>
          </div>
        </div>

        <div class="space-y-2 text-sm text-gray-500">
          <p>
            Este reporte contiene información médica confidencial. Por favor
            manténgalo seguro y compártalo únicamente con proveedores de atención
            médica autorizados.
          </p>
          <p>
            Para preguntas sobre este reporte, por favor contacte a su proveedor
            de atención médica.
          </p>
          <p class="font-medium">
            © {{.CurrentYear}} Equilibria Diagnostics. Todos los derechos reservados.
          </p>
        </div>
      </div>
    </div>
  </body>
</html> 